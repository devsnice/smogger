{"version":3,"sources":["../../../src/components/router/generate.js"],"names":["log","path","methods","console","Object","keys","forEach","method","setRouteName","operationId","defaultResponse","ctx","next","body","JSON","stringify","params","getRouterMethod","router","type","get","post","delete","put","createMethod","bind","createRouter","paths","Router","createMethodWithRouter","map","reduce","bindMethodToRouter","run"],"mappings":";;;;;;;AAAA;;AACA;;;;AAGA,MAAMA,GAAG,GAAG,CAAC,CAACC,IAAD,EAAOC,OAAP,CAAD,KAAqB;AAC/BC,EAAAA,OAAO,CAACH,GAAR,CAAa,eAAcC,IAAK,EAAhC;AACAE,EAAAA,OAAO,CAACH,GAAR,CAAa,cAAb;AACAI,EAAAA,MAAM,CAACC,IAAP,CAAYH,OAAZ,EAAqBI,OAArB,CAA6BC,MAAM,IAAI;AACrCJ,IAAAA,OAAO,CAACH,GAAR,CAAa,KAAIO,MAAO,EAAxB;AACD,GAFD;AAGAJ,EAAAA,OAAO,CAACH,GAAR,CAAY,EAAZ;AACA,SAAO,CAACC,IAAD,EAAOC,OAAP,CAAP;AACD,CARD;;AAUA,MAAMM,YAAY,GAAIC,WAAD,IAAkCA,WAAW,IAAI,IAAtE;;AACA,MAAMC,eAAe,GAAG,CAACC,GAAD,EAAMC,IAAN,KAAe;AACrCD,EAAAA,GAAG,CAACE,IAAJ,GAAY,WAAUC,IAAI,CAACC,SAAL,CAAeJ,GAAG,CAACK,MAAnB,EAA2B,IAA3B,EAAiC,CAAjC,CAAoC,EAA1D;AACAJ,EAAAA,IAAI;AACL,CAHD;;AAKA,MAAMK,eAAe,GAAIC,MAAD,IAAqBC,IAAD,IAAsB;AAChE,UAAQA,IAAR;AACE,SAAK,KAAL;AACE,aAAOD,MAAM,CAACE,GAAd;;AACF,SAAK,MAAL;AACE,aAAOF,MAAM,CAACG,IAAd;;AACF,SAAK,QAAL;AACE,aAAOH,MAAM,CAACI,MAAd;;AACF,SAAK,KAAL;AACE,aAAOJ,MAAM,CAACK,GAAd;;AACF,SAAK,QAAL;AACE,aAAOL,MAAM,CAACG,IAAd;;AACF;AACE,aAAOH,MAAM,CAACE,GAAd;AAZJ;AAcD,CAfD;;AAiBA,MAAMI,YAAY,GAChB,CAACN,MAAD,CAAoB;AAApB,KACEjB,IAAI,IAAI;AACN,CAACkB,IAAD,CAAqC;AAArC,EAAmB;AAACV,EAAAA;AAAD,CAAnB,KACEQ,eAAe,CAACC,MAAD,CAAf,CAAwBC,IAAxB,EAA8BM,IAA9B,CAAmCP,MAAnC,EAA2CV,YAAY,CAACC,WAAD,CAAvD,EAAsER,IAAtE,EAA4ES,eAA5E,CAJR;;AAMO,MAAMgB,YAAY,GAAIC,KAAD,IAAkB;AAC5C,QAAMT,MAAM,GAAG,IAAIU,kBAAJ,EAAf;AACA,QAAMC,sBAAsB,GAAGL,YAAY,CAACN,MAAD,CAA3C;AAEA,sBAAQS,KAAR,EACGG,GADH,CACO9B,GADP,EAEG8B,GAFH,CAEO,CAAC,CAAC7B,IAAD,EAAOC,OAAP,CAAD,KAAqB,CAAC,6BAAiBD,IAAjB,CAAD,EAAyBC,OAAzB,CAF5B,EAE+D;AAF/D,GAGG4B,GAHH,CAGO,CAAC,CAAC7B,IAAD,EAAOC,OAAP,CAAD,KAAqB,CAAC2B,sBAAsB,CAAC5B,IAAD,CAAvB,EAA+B,oBAAQC,OAAR,CAA/B,CAH5B,EAG8E;AAH9E,GAIG6B,MAJH,CAKI,uBACE,CAAC,CAACC,kBAAD,EAAqB9B,OAArB,CAAD,KAAmCA,OAAO,CAAC4B,GAAR,CAAY,yBAAaE,kBAAb,CAAZ,CADrC,CACmF;AADnF,GALJ,EAOO,EAPP,EASG1B,OATH,CASW2B,UATX,EAJ4C,CAa3B;;AAEjB,SAAOf,MAAP;AACD,CAhBM","sourcesContent":["import Router from 'koa-router';\nimport { normalizer, entries, run, spreadToArgs, formatRouterPath } from \"../../utils/utils\";\nimport type { HTTPMethod, Paths } from \"../../types/Swagger\";\n\nconst log = ([path, methods]) => {\n  console.log(`Create path ${path}`);\n  console.log(`With methods`);\n  Object.keys(methods).forEach(method => {\n    console.log(`– ${method}`);\n  });\n  console.log('');\n  return [path, methods];\n};\n\nconst setRouteName = (operationId: string): ?string => operationId || null;\nconst defaultResponse = (ctx, next) => {\n  ctx.body = `params: ${JSON.stringify(ctx.params, null, 2)}`;\n  next();\n};\n\nconst getRouterMethod = (router: Router) => (type: HTTPMethod) => {\n  switch (type) {\n    case 'get':\n      return router.get;\n    case 'post':\n      return router.post;\n    case 'delete':\n      return router.delete;\n    case 'put':\n      return router.put;\n    case 'update':\n      return router.post;\n    default:\n      return router.get;\n  }\n};\n\nconst createMethod =\n  (router: Router) => // save router\n    path => // save path\n      (type: HTTPMethod, {operationId}) => // bind method to router with saved path\n        getRouterMethod(router)(type).bind(router, setRouteName(operationId), path, defaultResponse);\n\nexport const createRouter = (paths: Paths) => {\n  const router = new Router();\n  const createMethodWithRouter = createMethod(router);\n\n  entries(paths)\n    .map(log)\n    .map(([path, methods]) => [formatRouterPath(path), methods]) // /path/{param} => /path/:param\n    .map(([path, methods]) => [createMethodWithRouter(path), entries(methods)]) // Создаем функцию для привязки метода к пути и получаем [methodName, methodParams]\n    .reduce(\n      normalizer(\n        ([bindMethodToRouter, methods]) => methods.map(spreadToArgs(bindMethodToRouter)) // bindMethodToRouter <- methodProps, возвращаем функцию привязки метода со всеми пропсами\n      ), []\n    )\n    .forEach(run); // Привязываем каждый метод к роутеру\n\n  return router;\n};\n"],"file":"generate.js"}